---
import "../styles/login.css";
---

<html lang="fr" class="login-root">
  <body class="login-body">
    <div class="login-container">
      <h1 class="login-heading">Connexion</h1>
      <form
        id="loginForm"
        class="login-card"
        aria-describedby="msg"
        aria-labelledby="login-heading"
      >
        <label class="form-field">
          <span class="field-label">Email</span>
          <input
            name="email"
            id="email"
            type="email"
            placeholder="Email"
            required
            autocomplete="email"
            class="input-field"
          />
        </label>
        <label class="form-field">
          <span class="field-label">Mot de passe</span>
          <input
            name="password"
            id="password"
            type="password"
            placeholder="Mot de passe"
            required
            autocomplete="current-password"
            class="input-field"
          />
        </label>
        <button class="btn btn--primary" data-variant="primary">
          Se connecter
        </button>
        <div class="oauth-buttons">
          <button
            id="googlelogin"
            class="btn btn--oauth btn--google"
            data-variant="oauth"
          >
            <svg
              class="btn__icon"
              viewBox="0 0 24 24"
              aria-hidden="true"
              focusable="false"
            >
              <path
                fill="#EA4335"
                d="M12 11.8v3.7h5.2c-.2 1.1-1.4 3.3-5.2 3.3-3.1 0-5.7-2.6-5.7-5.8S8.9 7.2 12 7.2c1.7 0 2.8.7 3.4 1.3l2.3-2.3C16.4 4.7 14.4 3.8 12 3.8 7.5 3.8 3.8 7.5 3.8 12s3.7 8.2 8.2 8.2c4.7 0 7.8 3.3 7.8 3.3L12 11.8z"
              ></path>
              <path
                fill="#34A853"
                d="M5.9 8.9l3 2.2C9.4 9 10.6 8 12 8c1 0 1.8.3 2.5.9l2.6-2.6C15.8 4.9 14.1 4 12 4 9.2 4 6.8 5.7 5.9 8.9z"
              ></path>
              <path
                fill="#FBBC05"
                d="M12 20c2.1 0 3.8-.7 5-1.9l-2.4-2c-.6.4-1.3.6-2.1.6-1.6 0-2.9-1.1-3.3-2.6l-3 2.4C6.2 18.4 8.9 20 12 20z"
              ></path>
              <path
                fill="#4285F4"
                d="M20 12c0-.7-.1-1.3-.2-1.9H12v3.6h4.5c-.2 1-.7 1.8-1.4 2.3l2.4 2C19.4 16.4 20 14.4 20 12z"
              ></path>
            </svg>
            <span class="btn__text">Se connecter avec Google</span>
          </button>
          <button
            id="githublogin"
            class="btn btn--oauth btn--github"
            data-variant="oauth"
          >
            <svg
              class="btn__icon"
              viewBox="0 0 24 24"
              aria-hidden="true"
              focusable="false"
            >
              <path
                fill="currentColor"
                d="M12 2C6.5 2 2 6.5 2 12c0 4.4 2.9 8.1 6.8 9.4.5.1.7-.2.7-.5v-2c-2.8.6-3.4-1.3-3.4-1.3-.4-1-1-1.3-1-1.3-.8-.6.1-.6.1-.6.9.1 1.4.9 1.4.9.8 1.4 2.2 1 2.7.8.1-.6.3-1 .5-1.2-2.2-.3-4.5-1.1-4.5-4.9 0-1.1.4-2 1-2.7-.1-.3-.4-1.3.1-2.7 0 0 .8-.3 2.8 1 .8-.2 1.6-.3 2.4-.3s1.6.1 2.4.3c2-1.3 2.8-1 2.8-1 .5 1.4.2 2.4.1 2.7.6.7 1 1.6 1 2.7 0 3.8-2.3 4.6-4.5 4.9.3.3.5.8.5 1.6v2.3c0 .3.2.6.7.5C19.1 20.1 22 16.4 22 12c0-5.5-4.5-10-10-10z"
              ></path>
            </svg>
            <span class="btn__text">Se connecter avec GitHub</span>
          </button>
          <button id="facebooklogin" class="btn btn--oauth">
            <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24"
              ><path
                d="M22 12a10 10 0 1 0-11.6 9.9v-7h-2.4V12h2.4V9.8c0-2.4 1.4-3.8 3.6-3.8 1 0 2 .2 2 .2v2.2h-1.1c-1.1 0-1.5.7-1.5 1.4V12h2.6l-.4 2.9h-2.2v7A10 10 0 0 0 22 12z"
              ></path></svg
            >
            Se connecter avec Facebook
          </button>
        </div>
      </form>
      <p id="msg" class="login-message" role="status" aria-live="polite"></p>
      <p class="signup-text">
        Pas encore de compte ? <a href="/register" class="signup-link"
          >S'inscrire</a
        >
      </p>
    </div>
    <script type="module">
      const { pb } = await import("/lib/pb.js");

      const form = document.getElementById("loginForm");
      form.onsubmit = async (e) => {
        e.preventDefault();
        try {
          await pb
            .collection("users")
            .authWithPassword(form.email.value, form.password.value);
          //verifiez si l'email est verifi?
          if (pb.authStore.isVerified === false) {
            document.getElementById("msg").textContent =
              "Veuillez v?rifier votre email avant de continuer.";
            return;
          }
          location.href = "/students";
        } catch (err) {
          document.getElementById("msg").textContent = "?%chec de connexion";
          console.error(err);
        }
      };
      const googlelogin = document.getElementById("googlelogin");
      googlelogin.onclick = async () => {
        try {
          await pb.collection("users").authWithOAuth2({ provider: "google" });
          location.href = "/students";
        } catch (err) {
          document.getElementById("msg").textContent =
            "?%chec de connexion Google";
          console.error(err);
        }
      };
      const githublogin = document.getElementById("githublogin");
      githublogin.onclick = async () => {
        try {
          await pb.collection("users").authWithOAuth2({ provider: "github" });
          location.href = "/students";
        } catch (err) {
          document.getElementById("msg").textContent =
            "?%chec de connexion GitHub";
          console.error(err);
        }
      };
      // Bouton "Se connecter avec Facebook"
      document.getElementById("facebooklogin").onclick = async () => {
        try {
          await pb.collection("users").authWithOAuth2({ provider: "facebook" });
          location.href = "/students";
        } catch (err) {
          // affiche un message d'erreur propre à l’UI existante
          console.error(err);
        }
      };
    </script>
  </body>
</html>
